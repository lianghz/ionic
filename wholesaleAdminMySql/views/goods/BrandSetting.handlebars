{{!-- 数据格 --}}
<table id="brand-dg" title="品牌管理" style="width:100%;height:250px;border-top:0px;" toolbar="#brand-tbr" data-options="singleSelect:true,collapsible:true,method:'get',fit:true,border:false,">
   <thead>
        <tr>
            <th data-options="field:'BrandId',width:150">品牌编号</th>
            <th data-options="field:'Name',width:200">品牌名称</th>
            <th data-options="field:'Company',width:200">公司名称</th>
            <th data-options="field:'Status',width:50">状态</th>
            <th data-options="field:'CreateUser',width:60">创建用户</th>
            <th data-options="field:'UpdateUser',width:60">更新用户</th>
            <th data-options="field:'CreateDate',width:150">创建时间</th>
            <th data-options="field:'UpdateDate',width:150">更新时间</th>
        </tr>
    </thead>
</table>
{{!-- 工具栏 --}}
<div id="brand-tbr">
    {{!--<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-upload" plain="true" onclick="$('#brand-dlg').dialog('open')">上传结果</a>--}}
    <a id="brand-btn-down" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-download" plain="true">下载结果</a>
    {{!--<a id="brand-btn-del" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="delrow()">删除选择</a>--}}
    <span class="datagrid-btn-separator" style="vertical-align: middle;display:inline-block;float:none"></span> {{!--
    <input id="brand-txt-bu" style="width:90px;height:25px">--}}
    <input id="brand-txt-name" style="width:120px;height:25px">
    <input id="brand-txt-company" style="width:120px;height:25px">
        <select id="brand-cbb-status" class="easyui-combobox" panelHeight="auto" style="width:100px">
            <option value="-1">选择状态</option>
            <option value="1">1-有效</option>
            <option value="0">0-无效</option>
        </select>
    <a id="brand-btn-search" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search">查询</a>
    <span class="datagrid-btn-separator" style="vertical-align: middle;display:inline-block;float:none"></span>
    <a id="brand-bt-save" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-add'" onclick="openDialogAdd()">添加</a>
    <a id="brand-bt-save" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-edit'" onclick="openDialogEdit()">修改</a>
   
</div>
{{!-- 数据上下文 --}}
<input id="brand-params" type="hidden" name="referrer" value="{{params}}">
<input id="brand-params2" type="hidden" name="referrer" value="{{params2}}">
{{!-- 表单 --}}
<div id="brand-dlg-add" class="easyui-dialog" title="添加品牌" style="width:400px;height:200px;padding:10px" data-options="
                closed: true,
                iconCls: 'icon-add',
                buttons: [{
                    text:'添加',
                    iconCls:'icon-ok',
                    handler:function(){
                        $('#brand-ff-add').submit();
                        
                    }
                },{
                    text:'取消',
                    iconCls:'icon-cancel',
                    handler:function(){
                        $('#brand-dlg-add').dialog('close');
                    }
                }]
            ">
    <form id="brand-ff-add" action="/goods/addbrand" method="post">
        <table>
            <tr>
                <td>
                    <input id="brand-ff-name" name="name"  style="width:300px" class="f1 easyui-textbox" data-options="label:'品牌名称:',prompt:'输入品牌名称',required:true,validateOnCreate:false,err:err"></input>
                </td>
            </tr>
            <tr>
                <td>
                    <input id="brand-ff-company" name="company" style="width:300px" class="f1 easyui-textbox tb" data-options="label:'公司名称:',prompt:'输入公司名称',required:true,validateOnCreate:false,err:err"></input>
                </td>
            </tr>
        </table>
        <input id="brand-ff-outlet" type="hidden" name="outlet" value="">
        <input id="brand-ff-loc" type="hidden" name="loc" value="">
        <input id="brand-ff-over" type="hidden" name="over" value="">
    </form>
</div>

<div id="brand-dlg-edit" class="easyui-dialog" title="修改品牌" style="width:400px;height:200px;padding:10px" data-options="
                closed: true,
                iconCls: 'icon-edit',
                buttons: [{
                    text:'修改',
                    iconCls:'icon-ok',
                    handler:function(){
                        $('#brand-ff-edit').submit();
                        
                    }
                },{
                    text:'取消',
                    iconCls:'icon-cancel',
                    handler:function(){
                        $('#brand-dlg-edit').dialog('close');
                    }
                }]
            ">
    <form id="brand-ff-edit" action="/goods/modifybrand" method="post">
        <table>
            <tr>
                <td>
                    <input id="brand-ff-edit-name" name="name"  style="width:300px" class="f1 easyui-textbox" data-options="label:'品牌名称:',prompt:'输入品牌名称',required:true,validateOnCreate:false,err:err"></input>
                </td>
            </tr>
            <tr>
                <td>
                    <input id="brand-ff-edit-company" name="company" style="width:300px" class="f1 easyui-textbox tb" data-options="label:'公司名称:',prompt:'输入公司名称',required:true,validateOnCreate:false,err:err"></input>
                </td>
            </tr>
            <tr><td>
            <select id="brand-cbb-edit-status" data-options="label:'状态:'" style="width:300px" name="status" class="easyui-combobox" panelHeight="auto" style="width:100px">
            <option value="1">1-有效</option>
            <option value="0">0-无效</option>
        </select>
            </td></tr>
            <input id="brand-ff-edit-id" type="hidden" name="brandId" value="">
        </table>
    </form>
</div>


{{!-- 脚本 --}}
<script>
    //var params = $('#brand-params').val();
    //var params2 = $('#brand-params2').val();
    //console.log(params2);
    //params = eval('[' + params + ']');
    //params2 = eval('[' + params2 + ']');

    $('#brand-dg').datagrid({
        url: '/goods/getbrand',
        pagePosition: 'bottom',
        //pagination: true,
        rownumbers: true,
        //pageSize: 30,
        singleSelect: true,
        //frozenColumns: params2,
        //columns: params,
        queryParams: {
            status: -1
        }
    });

    $.extend($.fn.textbox.methods, {
        addClearBtn: function (jq, iconCls) {
            return jq.each(function () {
                var t = $(this);
                var opts = t.textbox('options');
                opts.icons = opts.icons || [];
                opts.icons.unshift({
                    iconCls: iconCls,
                    handler: function (e) {
                        $(e.data.target).textbox('clear').textbox('textbox').focus();
                        $(this).css('visibility', 'hidden');
                    }
                });
                t.textbox();
                if (!t.textbox('getText')) {
                    t.textbox('getIcon', 0).css('visibility', 'hidden');
                }
                t.textbox('textbox').bind('keyup', function () {
                    var icon = t.textbox('getIcon', 0);
                    if ($(this).val()) {
                        icon.css('visibility', 'visible');
                    } else {
                        icon.css('visibility', 'hidden');
                    }
                });
            });
        }
    });


    $(function () {

        //-----

        $('#brand-txt-name').textbox({
            prompt: '品牌名称',
            icons: [{
                iconCls: 'icon-filter'
            }]
        }).textbox('addClearBtn', 'icon-clear');

        $('#brand-txt-company').textbox({
            prompt: '公司名称',
            icons: [{
                iconCls: 'icon-filter'
            }]
        }).textbox('addClearBtn', 'icon-clear');
        //------

        $('#brand-ff-add').form({
            onSubmit: function () {
                if ($(this).form('enableValidation').form('validate')) {
                    $('#brand-dlg-add').dialog('close');
                    MaskUtil.mask();
                    return true;
                } else {
                    return false;
                }
            },
            success: function (data) {
                MaskUtil.unmask();
                data = JSON.parse(data);
                $.messager.alert('消息提示:', "<center>"+data[0]["pramResult"]+"</center>");
            },

        });

         $('#brand-ff-edit').form({
            onSubmit: function () {
                if ($(this).form('enableValidation').form('validate')) {
                    $('#brand-dlg-edit').dialog('close');
                    MaskUtil.mask();
                    return true;
                } else {
                    return false;
                }
            },
            success: function (data) {
                MaskUtil.unmask();
                data = JSON.parse(data);
                $.messager.alert('消息提示:', "<center>"+data[0]["pramResult"]+"</center>");
            },

        });

        //down
        $("#brand-btn-down").click(function () {
            MaskUtil.mask();
            var params = $('#brand-dg').datagrid("options").queryParams;
            var param = '?';
            for (key in params) {
                param += key + '=' + params[key] + '&';
            }
            param += 'a=1'

            url = "/down/brand" + param;
            $.get(url, function (result) {
                $.messager.alert('结果已生成', result);
                MaskUtil.unmask();
            });
            
        })
        //end down
        //search
        $("#brand-btn-search").click(function () {
            $('#brand-dg').datagrid('load', {
                company: $('#brand-txt-company').textbox('getValue'),
                name: $('#brand-txt-name').textbox('getValue'),
                status:$('#brand-cbb-status').combobox('getValue')
            });
        })
        //end search

        ///save
        //down
        {{!--$("#brand-btn-down").click(function () {
            var params = $('#brand-dg').datagrid("options").queryParams;
            var param = '?period=' + (params.period ? params.period : '') + '&outlet=' + (params.outlet ? params.outlet : '') + '&loc=' + (params.loc ? params.loc : '') + '&name=' + (params.name ? params.name : '');
            if (!params) param = "";
            url = "/down/brand" + param;
            $.get(url, function (result) {
                $.messager.alert('结果已生成', result);
            });
        })--}}
        ///end save


    });

    function formatField(value, row, index, n1, n2) {
        return (row[n1] ? (row[n1][n2] ? row[n1][n2] : "") : '');

    }

    //---------------

    function openDialogAdd() {
        var params = $('#brand-dg').datagrid("options").queryParams;
        $('#brand-ff-over').val("");
        $('#brand-ff-outlet').val(params.outlet ? params.outlet : '');
        $('#brand-ff-loc').val(params.loc ? params.loc : '');
        $('#brand-ff-name').val(params.name ? params.name : '');
        var v = $('#brand-txt-period').val();
        $('#brand-ff-period').textbox({
            readonly: false,
            value: v,
        }).textbox({ readonly: true, });

        $('#brand-dlg-add').dialog({
            modal: true,
        }).dialog('open');
    }

    function openDialogEdit() {
        var row = $('#brand-dg').datagrid('getSelected');
        if(!row)
        {
            $.messager.alert('提示','<center>请选择一个品牌!</center>');
        }
        $('#brand-ff-edit').form('load',{
            brandId:row.BrandId,
            name:row.Name,
            company:row.Company,
            status:row.Status
        });

        $('#brand-dlg-edit').dialog({
            modal: true,
        }).dialog('open');
    }

    

</script>